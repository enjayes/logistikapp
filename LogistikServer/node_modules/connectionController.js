/**
 * connectionController
 *
 *
 *
 *
 * @date 21.11.14 - 10:25
 *
*/



connectionController={

    preferences:null,
    io:null,
    http:null,
    websiteController:null,
    appController:null,
    messageType: {
        connection: "c"
    },
   clientType: {
       app:0,
       website: 1
    },
    init:function(preferences,io,http,adminController,appController){
       this.preferences = preferences;

       this.io= io;
       this.http=http;
       this.adminController = adminController;
       this.appController = appController;
       //Listen on Post
        this.http.listen(this.preferences.port, function(){
            console.log("Server listening on port "+connectionController.preferences.port);
        });

        //Connected
        this.io.on('connection', function (socket) {

            //Verbindung aufgebaut, sende Best√§tigung
            socket.emit('message', {t:connectionController.messageType.connection});

            //Messages des Sockets weiterreichen
            socket.on('message',  function (msg) {
                if (msg.c==connectionController.clientType.app)
                    appController.messageRecieved(socket, msg);
                else if (msg.c==connectionController.clientType.website){
                    adminController.messageRecieved(socket, msg);
                }
            }  );

        });

    }

}






module.exports = connectionController;